# HelloSysadmin
Это набор скриптов для удалённого запуска смешнявок(картинки, проги, звуки) на электронной доске через телеграмм бота.
50% работы взял - https://github.com/SRLQNL

ТРЕБУЕТСЯ ДЛЯ РАБОТЫ: пк и установленный python добавленный в path

Раздел 1 - Установка бота и клиента(удалённого пк/доски):

п.1 "Пинкод" и "Задержка клиента": 

1)в качестве защиты от дудоса бота и соответственно перехвата управления добавлен пинкод.
2)Google установил квоту на использование API в минуту. Опытным путём было выяснено, что 1 парсинг в 3 секунды входит в квоту. На свой страх и риск можно поставить занчиение ниже.

faq:
Как уменюшить/увеличить задержку выполнения команд? - Задержку можно изменить, изменив число(секунд) после "delay =". Кавычки не убирайте, иначе прога уйдёт в ошибку. 
Как поменять пинкод? - Пинкод можно изменить, изменив число после "_pin=".
Какие правила установки пинкода? - Пинкод должен быть числовой без точки(int)
Можно ли убрать пинкод? - Убрать пинкод через конфиг нельзя(опытные могут вырезать его на уровне кода) в целях безопасности
Какой пинкод по умолчанию? - С коробки Пинкод равен 1


п.2 "Токен бота и сам Бот: 

Создать бота, а соответственно получить токен можно через тг бота @BotFather.
1) Заходим в тг бота @BotFather и кликаем на /start
2) Вводим/нажимаем на /newbot
3) Придумываем имя
4) Придумываем юзернейм. Юзернэйм должен быть на латинице и заканчиваться на "_bot", например "test_bot" запомним этот юзернэйм т.к переходить в чат к боту через него
5) Получем Токен


п.3 "id таблицы и таблица":

1) Открываем Google Sheets(таблицы) и создаём таблицу. Ничего не меняем!!! Для правильно копирования ссылки нажимаем на "Настройки доступа" и выбираем в пункте прав на изменение таблицы "Все у кого есть ссылка". Ниже нажимаем кнопку "Копировать ссылку"
2) Открывам блокнот и вствляем ссылку. Id таблицы находится в ссылке на таблицу(id находится после d/ и до /edit, в моём случае - 1RKFthr5TGKE5BCUBmNdRJgH-vPfgh_bj)
Ничего, кроме того, что сказано в readme не трогайте, что связано с таблицей и её настройками!!!

п.4 "GOOGLE API":

1) Логинимся на cloud.google.com и нажимаем "console"
2) В списке стран выбираем "United States" и соглашаемся с условиями пользования
3) Нажимаем на "Select a project", нажимаем на "New Project"
4) Создаём адекватное название, например "python" и нажимем "Create"
5) Выбираем созданный нами проект через меню "Select a project"
6) Нажимаем на 3 полоски и в списке выбираем "APIs & Services", далее выбираем "Library"
7) В поиске вводим "Google Sheets API" и выбираем google таблицы
8) В разделе "Product details" от "Google Sheets API" нажимаем "Enable"
9) В открытом меню управления "Google Sheets API" нажимаем на "Credentials", далее "Create credentials" и выбираем "Service Account"
10) Создаём 2 аккаунта с именами и id "server" и "client" соответственно. 2й и 3й разделы создания аккаунта пропускаем.
11) В результате получаем 2 сервис аккаунта с 2мя почтами.
12) Переходим в таблицу, которую создали в п.3 раздела "Установка бота и клиента(удалённого пк/доски)"
13) Нажимаем на "Настройки доступа" и добавляем 2 в качестве редактора 2 почты сервис аккаунта (может вылести ошибка, прокликайте кнопку несколько раз)
14) Возвращяемся к консоле google
15) Нажимаем на 1ю почту, в моём случае - client
16) Переходим в раздел "Keys" и нажимаем "Add key", далее "Create a new Key", потом выбираем "JSON" и скачиваем с названием client/server(в зависимости от выбранной вами почты в п.15)
17) Делаем так и с 2й почтой, в моём случае - server
18) Получаем на выходе 2 JSON файла. Один от сервисной учетки записи "server", другой от "client"


Раздел 2 - Сборка и установка всего для проекта

п.0 "подготовительный":
1) В одну папку n закидываем 2 JSON файла и запоминаем/записывем id таблицы и Токен бота  (таблица - раздел 1 п.3, подпункт 2
бот - раздел 1, п.2, подпункт 5)

п.1 "Сборка файлов клиента":
1) В папку n скачиваем и распоковываем репозиторий с гитхаба(Code->Download zip), !!!игнорируем readme.md!!!
2) Заходим в client(Эта папка пойдёт в будущем на доску aka "жертву"). Закидывем JSON клиента в папку с .py скриптами. Открываем main.py через блокнот и запонляем:
2.1) В переменную account_file межку ковычек вводим наш путь к JSON файлу(в нашем примере просто НАЗВАНИЕ.JSON
2.2) В переменную spreadsheet_id межку ковычек вводим наш id таблицы
2.3) Delay лучше не трогать

п.2 "Сборка файлов сервера":
1) Заходим в server(Эта папка пойдёт в будущем на пк/хостинг для запуска бота). Закидывем JSON сервера в папку с .py скриптами. Открываем main.py через блокнот и запонляем:
1.1) В переменную account_file межку ковычек вводим наш путь к JSON файлу(в нашем примере просто НАЗВАНИЕ.JSON
1.2) В переменную spreadsheet_id межку ковычек вводим наш id таблицы
1.3) В переменную _pin после равно вводим наш пинкод и запоминаем его
1.4) В переменную token межку ковычек вводим наш токен тг бота.

Для п.1 и п.2 : не забываем сохранятся

п.3 "Библиотеки":
1) Для сервака(пк/хостинг для запуска бота) вводим в терминал(на винде - cmd(находим в поиске) на линуксе - обычно terminal)(ПОСЛЕДОВАТЕЛЬНО):
1.1)pip install --upgrade google-api-python-client
1.2)pip install telebot

!!!ВАЖНО: НА ЛИНУКСЕ ВМЕСТО pip ПИШИТЕ pip3

3) Для жертвы(доски на Mos(линукс))
4) Нажимаем на CTRL+ALT+T и открывется терминал.
5) python3 -m ensurepip --user
6) export PATH=$HOME/.local/bin:$PATH
7) Перезапускаем терминал(НЕ ДОСКУ)
8) source ~/.bashrc
9) pip3 --version
10) Если вывелось что-то вроде pip 22.0.4 form /home/test/.local/lib/python3.8/site-packages/pip (python 3.8), то всё прошло гладко, иначе вернитесь к п.3 и сделаете всё сначала
11) pip3 install --upgrade google-api-python-client
12) pip3 install requests

п.4 "Запуск бота и скрипта на доске"
1) Начнём с бота. Его лучше запускать на другом пк(можно на вашем из дома)
2) 2 раза кликните на main.py, который находится в папке server
3) Если у вас вылезло пустое окно, то всё ок. Перейтие к боту через тк и напишите /start для проверки работоспособности
4) Готово! бот есть.
 
!!!ВАЖНО: ЕСЛИ ВЫ ВЫКЛЮЧИТЕ ПК/СКРИПТ, ТО БОТ ТОЖЕ ЛЯЖЕТ

1) Доска. Закидываем подготовленные файлы в папке client на флэху и втыкаем в доску
2) Перекидываем папку с файлами на доску(желательно не на рабочий стол).
3) Открываем папку и нажимаем ПКМ->открыть в теринале
4) Прописывем:
5) python3 main.py
6) Если вылизает ошибка типа: No Module Found 'какой-то модуль', то доустанавливаем:
7) pip3 install какой-то модуль
8) Скрываем окно терминала, НЕ ЗАКРЫВАЕМ

   !!!ВАЖНО: ЕСЛИ ВЫ ВЫКЛЮЧИТЕ ДОСКУ/СКРИПТ, ТО СКРИПТ ТОЖЕ ЛЯЖЕТ

Всё готово! Если вы в школе 1584 старшего корпуса, могу за доп плату установить/решить проблему за вас на доску(договариваться через тг: @KrackF1)
